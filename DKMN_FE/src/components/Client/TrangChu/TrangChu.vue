/<template>
  <div class="container-fluid p-0">
    <!-- Hero Section with Search -->
    <section class="hero position-relative">
      <!-- Decorative background -->
      <span class="blob blob-1"></span>
      <span class="blob blob-2"></span>
      <span class="blob blob-3"></span>
      <span class="hero__grid"></span>
      <div class="hero__overlay"></div>

      <!-- Content -->
      <div class="hero__content">
        <div class="hero__glass shadow-lg">
          <div class="text-center mb-4">
       
            <h1 class="hero__title">
              T√¨m v√† ƒë·∫∑t v√© <span class="text-primary">d·ªÖ d√†ng</span>
            </h1>
            <p class="hero__subtitle text-white">
              H·ªá th·ªëng ƒë·∫∑t v√© xe kh√°ch, t√†u h·ªèa, m√°y bay v·ªõi gi√° t·ªët nh·∫•t
            </p>
          </div>

          <!-- üîç Search Form -->
          <div id="search" class="search-form">
            <div class="row g-3">
              <!-- Vehicle Type -->
              <div class="col-md-3">
                <label class="form-label text-white fw-semibold"
                  >Lo·∫°i ph∆∞∆°ng ti·ªán</label
                >
                <select v-model="searchForm.vehicleType" class="form-select">
                  <option value="">Ch·ªçn ph∆∞∆°ng ti·ªán</option>
                  <option value="bus">Xe kh√°ch</option>
                  <option value="train">T√†u h·ªèa</option>
                  <option value="plane">M√°y bay</option>
                </select>
              </div>

              <!-- From -->
              <div class="col-md-3">
                <label class="form-label text-white fw-semibold">N∆°i ƒëi</label>
                <select v-model="searchForm.from" class="form-select">
                  <option value="" disabled>Ch·ªçn n∆°i ƒëi</option>
                  <option v-for="city in cities" :key="city" :value="city">
                    {{ city }}
                  </option>
                </select>
              </div>

              <!-- To -->
              <div class="col-md-3">
                <label class="form-label text-white fw-semibold">N∆°i ƒë·∫øn</label>
                <select v-model="searchForm.to" class="form-select">
                  <option value="" disabled>Ch·ªçn n∆°i ƒë·∫øn</option>
                  <option v-for="city in cities" :key="city" :value="city">
                    {{ city }}
                  </option>
                </select>
              </div>

              <!-- Departure Date -->
              <div class="col-md-3">
                <label class="form-label text-white fw-semibold">Ng√†y ƒëi</label>
                <input
                  v-model="searchForm.departureDate"
                  type="date"
                  class="form-control"
                />
              </div>
            </div>

            <div class="row g-3 mt-2">
              <!-- Pickup/Drop-off Stations (for buses) -->
              <div
                class="col-md-3"
                v-if="['bus','train','plane'].includes(searchForm.vehicleType) && searchForm.from"
              >
                <label class="form-label text-white fw-semibold">{{ pickupLabel }}</label>
                <select v-model="searchForm.pickupStation" class="form-select">
                  <option value="" disabled>Ch·ªçn ƒëi·ªÉm ƒë√≥n</option>
                  <option
                    v-for="station in availablePickupStations"
                    :key="'pickup-' + station"
                    :value="station"
                  >
                    {{ station }}
                  </option>
                </select>
              </div>

              <div
                class="col-md-3"
                v-if="['bus','train','plane'].includes(searchForm.vehicleType) && searchForm.to"
              >
                <label class="form-label text-white fw-semibold">{{ dropoffLabel }}</label>
                <select v-model="searchForm.dropoffStation" class="form-select">
                  <option value="" disabled>Ch·ªçn ƒëi·ªÉm tr·∫£</option>
                  <option
                    v-for="station in availableDropoffStations"
                    :key="'dropoff-' + station"
                    :value="station"
                  >
                    {{ station }}
                  </option>
                </select>
              </div>

              <!-- Return Date -->
              <div class="col-md-3">
                <label class="form-label text-white fw-semibold"
                  >Ng√†y v·ªÅ (t√πy ch·ªçn)</label
                >
                <input
                  v-model="searchForm.returnDate"
                  type="date"
                  class="form-control"
                />
              </div>

              <!-- Passengers -->
              <div class="col-md-3">
                <label class="form-label text-white fw-semibold"
                  >S·ªë h√†nh kh√°ch</label
                >
                <select v-model="searchForm.passengers" class="form-select">
                  <option value="1">1 h√†nh kh√°ch</option>
                  <option value="2">2 h√†nh kh√°ch</option>
                  <option value="3">3 h√†nh kh√°ch</option>
                  <option value="4">4 h√†nh kh√°ch</option>
                  <option value="5">5 h√†nh kh√°ch</option>
                  <option value="5+">Kh√°c</option>
                </select>
                <div v-if="searchForm.passengers === '5+'" class="mt-2">
                  <input
                    v-model.number="customPassengers"
                    type="number"
                    min="6"
                    class="form-control"
                    placeholder="Nh·∫≠p s·ªë h√†nh kh√°ch "
                  />
                </div>
              </div>

              <!-- Company/Carrier selection -->
              <div
                class="col-md-3"
                v-if="['bus','train','plane'].includes(searchForm.vehicleType)"
              >
                <label class="form-label text-white fw-semibold">{{ companyLabel }}</label>
                <select v-model="searchForm.company" class="form-select">
                  <option value="">T·∫•t c·∫£</option>
                  <option
                    v-for="name in availableCompanies"
                    :key="'co-' + name"
                    :value="name"
                  >
                    {{ name }}
                  </option>
                </select>
              </div>

              <!-- Search Button -->
              <div class="col-md-6 d-flex align-items-end">
                <button
                  @click="searchTrips"
                  class="btn btn-primary btn-lg w-100 search-btn"
                  :disabled="!isSearchValid"
                >
                  <i class="bx bx-search me-2"></i>
                  T√¨m chuy·∫øn
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Seat Selection Modal -->
    <div v-if="seatModal.visible" class="seat-modal-backdrop">
      <div class="seat-modal">
        <div
          class="p-3 border-bottom d-flex justify-content-between align-items-center"
        >
          <h6 class="mb-0">
            Ch·ªçn gh·∫ø - {{ seatModal.trip?.company }} ({{
              seatModal.trip?.vehicleType
            }})
          </h6>
          <button
            class="btn btn-sm btn-outline-secondary"
            @click="cancelSeatSelection"
          >
            ƒê√≥ng
          </button>
        </div>
        <div class="p-3">
          <div class="mb-3 text-muted small">
            C√≥ th·ªÉ ch·ªçn t·ªëi ƒëa {{ maxSelectableSeats }} gh·∫ø.
          </div>
          
          <!-- Seat Status Legend -->
          <div class="seat-legend mb-3">
            <div class="legend-item">
              <div class="legend-color seat-empty"></div>
              <span>Gh·∫ø tr·ªëng</span>
            </div>
            <div class="legend-item">
              <div class="legend-color seat-selected"></div>
              <span>ƒêang ch·ªçn</span>
            </div>
            <div class="legend-item">
              <div class="legend-color seat-booked"></div>
              <span>ƒê√£ ƒë·∫∑t</span>
            </div>
            <div class="legend-item">
              <div class="legend-color seat-unavailable"></div>
              <span>Kh√¥ng b√°n</span>
            </div>
          </div>
          
 <!-- Seat Layout B (hi·ªÉn th·ªã theo lo·∫°i ph∆∞∆°ng ti·ªán) -->
<div v-if="seatModal.trip?.vehicleType === 'Xe kh√°ch'" class="bus-seat-container">
  <!-- Gi·ªØ nguy√™n layout xe kh√°ch 2 t·∫ßng -->
  <!-- Two Column Layout -->
  <div class="two-column-layout">
    <!-- Left Column: Lower Deck -->
    <div class="deck-column lower-deck">
      <div class="deck-title">T·∫¶NG D∆Ø·ªöI</div>

      <!-- Driver Row -->
      <div class="driver-row">
        <div class="driver-icon">
          <img
            src="https://icons.veryicon.com/png/o/miscellaneous/icheyong/steering-wheel-14.png"
            alt="Steering Wheel Icon"
            width="36"
            height="36"
          />
        </div>
      </div>

      <!-- Seat Matrix -->
      <div class="seat-matrix">
        <div
          v-for="row in seatModal.layout.slice(0, 4)"
          :key="'lower-r' + row[0].id"
          class="seat-row"
        >
          <!-- Left Column -->
          <div class="seat-column">
            <div
              v-for="seat in row.slice(0, 2)"
              :key="seat.id"
              class="seat-btn"
              :class="{
                'seat-empty': seat.available && !seatModal.seatsSelected.includes(seat.id),
                'seat-selected': seatModal.seatsSelected.includes(seat.id),
                'seat-unavailable': !seat.available,
                'seat-booked': seat.booked
              }"
              @click="toggleSeat(seat)"
              :title="seat.label"
            >
              {{ seat.label }}
            </div>
          </div>

          <!-- Aisle -->
          <div class="aisle"></div>

          <!-- Right Column -->
          <div class="seat-column">
            <div
              v-for="seat in row.slice(2, 4)"
              :key="seat.id"
              class="seat-btn"
              :class="{
                'seat-empty': seat.available && !seatModal.seatsSelected.includes(seat.id),
                'seat-selected': seatModal.seatsSelected.includes(seat.id),
                'seat-unavailable': !seat.available,
                'seat-booked': seat.booked
              }"
              @click="toggleSeat(seat)"
              :title="seat.label"
            >
              {{ seat.label }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vertical Divider -->
    <div class="vertical-divider"></div>

    <!-- Right Column: Upper Deck -->
    <div class="deck-column upper-deck">
      <div class="deck-title">T·∫¶NG TR√äN</div>

      <!-- Empty Driver Row for alignment -->
      <div class="driver-row empty"></div>

      <!-- Seat Matrix -->
      <div class="seat-matrix">
        <div
          v-for="row in seatModal.layout.slice(4)"
          :key="'upper-r' + row[0].id"
          class="seat-row"
        >
          <!-- Left Column -->
          <div class="seat-column">
            <div
              v-for="seat in row.slice(0, 2)"
              :key="seat.id"
              class="seat-btn"
              :class="{
                'seat-empty': seat.available && !seatModal.seatsSelected.includes(seat.id),
                'seat-selected': seatModal.seatsSelected.includes(seat.id),
                'seat-unavailable': !seat.available,
                'seat-booked': seat.booked
              }"
              @click="toggleSeat(seat)"
              :title="seat.label"
            >
              {{ seat.label }}
            </div>
          </div>

          <!-- Aisle -->
          <div class="aisle"></div>

          <!-- Right Column -->
          <div class="seat-column">
            <div
              v-for="seat in row.slice(2, 4)"
              :key="seat.id"
              class="seat-btn"
              :class="{
                'seat-empty': seat.available && !seatModal.seatsSelected.includes(seat.id),
                'seat-selected': seatModal.seatsSelected.includes(seat.id),
                'seat-unavailable': !seat.available,
                'seat-booked': seat.booked
              }"
              @click="toggleSeat(seat)"
              :title="seat.label"
            >
              {{ seat.label }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üöÜ Layout cho T√†u h·ªèa -->
<div
  v-else-if="seatModal.trip?.vehicleType === 'T√†u h·ªèa'"
  class="train-seat-container"
>
 

  <!-- Toa hi·ªán t·∫°i -->
  <div class="train-car mt-3">
    <div class="train-car-title text-primary fw-bold mb-2">
      Toa {{ activeCar + 1 }}A: Ng·ªìi m·ªÅm
    </div>
    <p class="text-muted small mb-3">
      Gi√° hi·ªÉn th·ªã tr√™n gh·∫ø l√† gi√° v√© cho 1 ng∆∞·ªùi l·ªõn.
    </p>

    <!-- Kh·ªëi hi·ªÉn th·ªã gh·∫ø -->
    <div class="train-layout">
      <!-- M≈©i t√™n tr√°i -->
      <div class="arrow-btn left" @click="activeCar = Math.max(0, activeCar - 1)">
        ‚Äπ
      </div>

      <div class="train-seats">
        <!-- H√†ng tr√™n -->
        <div class="seat-row" v-for="row in 1" :key="'upper-'+row">
          <div
            v-for="seat in 8"
            :key="'upper-seat-'+row+'-'+seat"
            class="train-seat"
            :class="{ selected: seatModal.seatsSelected.includes(`T${activeCar}-${row}-${seat}`) }"
            @click="toggleTrainSeat(`T${activeCar}-${row}-${seat}`)"
          >
            <span class="seat-number">{{ (row - 1) * 8 + seat }}</span>
            <div class="seat-price">155K</div>
          </div>
        </div>

        <div class="hallway">H √Ä N H &nbsp; L A N G</div>

        <!-- H√†ng d∆∞·ªõi -->
        <div class="seat-row" v-for="row in 1" :key="'lower-'+row">
          <div
            v-for="seat in 8"
            :key="'lower-seat-'+row+'-'+seat"
            class="train-seat"
            :class="{ selected: seatModal.seatsSelected.includes(`B${activeCar}-${row}-${seat}`) }"
            @click="toggleTrainSeat(`B${activeCar}-${row}-${seat}`)"
          >
            <span class="seat-number">{{ (row - 1) * 8 + seat + 32 }}</span>
            <div class="seat-price">155K</div>
          </div>
        </div>
      </div>

      <!-- M≈©i t√™n ph·∫£i -->
      <div class="arrow-btn right" @click="activeCar = Math.min(totalCars - 1, activeCar + 1)">
        ‚Ä∫
      </div>
    </div>
  </div>
</div>


<!-- ‚úàÔ∏è Layout cho M√°y bay -->
<div
  v-else-if="seatModal.trip?.vehicleType === 'M√°y bay'"
  class="plane-seat-container"
>
  <div class="plane-header text-center mb-3">
    
    <p class="text-muted small mb-0">Ch·ªçn gh·∫ø ng·ªìi mong mu·ªën c·ªßa b·∫°n</p>
  </div>

  <div class="plane-layout">
    <div class="plane-wrapper">
      <!-- ‚úÖ Ph·∫ßn gh·∫ø -->
      <div class="plane-seats">
        <!-- H√†ng A‚ÄìC (b√™n tr√°i h√†nh lang) -->
        <div
          v-for="rowLabel in ['A','B','C']"
          :key="'top-'+rowLabel"
          class="seat-row"
        >
          <div
            v-for="col in 12"
            :key="rowLabel + col"
            class="plane-seat"
            :class="{
              selected: seatModal.seatsSelected.includes(rowLabel + col)
            }"
            @click="togglePlaneSeat(rowLabel + col)"
          >
            {{ rowLabel + col }}
          </div>
        </div>

        <!-- ‚úÖ H√†nh lang -->
        <div class="hallway">
          H &nbsp;√Ä&nbsp; N &nbsp;H &nbsp;L &nbsp;A &nbsp;N &nbsp;G
        </div>

        <!-- H√†ng D‚ÄìF (b√™n ph·∫£i h√†nh lang) -->
        <div
          v-for="rowLabel in ['D','E','F']"
          :key="'bot-'+rowLabel"
          class="seat-row"
        >
          <div
            v-for="col in 12"
            :key="rowLabel + col"
            class="plane-seat"
            :class="{
              selected: seatModal.seatsSelected.includes(rowLabel + col)
            }"
            @click="togglePlaneSeat(rowLabel + col)"
          >
            {{ rowLabel + col }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
















<div class="d-flex justify-content-between align-items-center">
  <div>
    <span class="me-2">ƒê√£ ch·ªçn:</span>
    <strong>{{ seatModal.seatsSelected.length }}</strong>
    <span class="ms-2 text-muted">
      T·ªïng:
      {{
        formatPrice(
          (seatModal.trip?.price || 0) *
            seatModal.seatsSelected.length
        )
      }}
    </span>
  </div>
  <div class="d-flex gap-2">
    <button
      class="btn btn-outline-secondary"
      @click="cancelSeatSelection"
    >
      H·ªßy
    </button>
    <button
      class="btn btn-primary"
      :disabled="seatModal.seatsSelected.length === 0"
      @click="confirmSeats"
    >
      Ti·∫øp t·ª•c thanh to√°n
    </button>
  </div>
</div>


        </div>
      </div>
    </div>

   
    
    <!-- Search Results Section -->
    <section v-if="showResults" class="results-section py-5">
      <div class="container">
        <div class="row">
          <!-- Filters Sidebar -->
          <div class="col-lg-3">
            <div class="filters-card">
              <h5 class="mb-3">B·ªô l·ªçc</h5>

              <!-- Time Filter -->
              <div class="filter-group mb-4">
                <h6>Gi·ªù kh·ªüi h√†nh</h6>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="morning"
                    v-model="filters.time.morning"
                  />
                  <label class="form-check-label" for="morning"
                    >S√°ng (6h-12h)</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="afternoon"
                    v-model="filters.time.afternoon"
                  />
                  <label class="form-check-label" for="afternoon"
                    >Chi·ªÅu (12h-18h)</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="evening"
                    v-model="filters.time.evening"
                  />
                  <label class="form-check-label" for="evening"
                    >T·ªëi (18h-24h)</label
                  >
                </div>
              </div>

              <!-- Price Filter -->
              <div class="filter-group mb-4">
                <h6>Gi√° v√©</h6>
                <div class="price-range">
                  <input
                    type="range"
                    class="form-range"
                    min="0"
                    max="1000000"
                    v-model="filters.price.max"
                  />
                  <div class="d-flex justify-content-between">
                    <span>0ƒë</span>
                    <span>{{ formatPrice(filters.price.max) }}</span>
                  </div>
                </div>
              </div>

              <!-- Other Filters -->
              <div class="filter-group mb-4">
                <h6>Kh√°c</h6>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="available"
                    v-model="filters.available"
                  />
                  <label class="form-check-label" for="available"
                    >C√≤n gh·∫ø</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="freeCancel"
                    v-model="filters.freeCancel"
                  />
                  <label class="form-check-label" for="freeCancel"
                    >H·ªßy mi·ªÖn ph√≠</label
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Results -->
          <div class="col-lg-9">
            <!-- Sort Options -->
            <div class="sort-options mb-4">
              <div class="d-flex justify-content-between align-items-center">
                <h5>K·∫øt qu·∫£ t√¨m ki·∫øm ({{ filteredTrips.length }} chuy·∫øn)</h5>
                <select v-model="sortBy" class="form-select w-auto">
                  <option value="default">M·∫∑c ƒë·ªãnh</option>
                  <option value="time-early">Gi·ªù ƒëi s·ªõm</option>
                  <option value="time-late">Gi·ªù ƒëi mu·ªôn</option>
                  <option value="price-low">Gi√° th·∫•p</option>
                  <option value="price-high">Gi√° cao</option>
                  <option value="rating">ƒê√°nh gi√° cao</option>
                </select>
              </div>
            </div>

            <!-- Trip Cards -->
            <div class="trip-cards">
              <div
                v-for="trip in sortedTrips"
                :key="trip.id"
                class="trip-card mb-3"
              >
                <div class="row g-0">
                  <div class="col-md-8">
                    <div class="trip-info p-3">
                      <div
                        class="d-flex justify-content-between align-items-start mb-2"
                      >
                        <div>
                          <h6 class="mb-1">{{ trip.company }}</h6>
                          <small class="text-muted">{{
                            trip.vehicleType
                          }}</small>
                        </div>
                        <div class="rating">
                          <i class="bx bxs-star text-warning"></i>
                          <span>{{ trip.rating }}</span>
                        </div>
                      </div>

                      <div class="trip-details">
                        <div class="d-flex align-items-center">
                          <div class="time-info">
                            <div class="departure-time">
                              {{ trip.departureTime }}
                            </div>
                            <div class="station">{{ trip.fromStation }}</div>
                          </div>

                          <div class="trip-route">
                            <div class="duration">{{ trip.duration }}</div>
                            <div class="route-line"></div>
                          </div>

                          <div class="time-info text-end">
                            <div class="arrival-time">
                              {{ trip.arrivalTime }}
                            </div>
                            <div class="station">{{ trip.toStation }}</div>
                          </div>
                        </div>
                      </div>

                      <div class="trip-features mt-2">
                        <span
                          v-if="trip.freeCancel"
                          class="badge bg-success me-2"
                          >H·ªßy mi·ªÖn ph√≠</span
                        >
                        <span
                          v-if="trip.availableSeats > 0"
                          class="badge bg-info me-2"
                          >{{ trip.availableSeats }} gh·∫ø tr·ªëng</span
                        >
                        <span class="badge bg-secondary">{{
                          trip.seatType
                        }}</span>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="trip-price p-3 text-center">
                      <div class="price">{{ formatPrice(trip.price) }}</div>
                      <small class="text-muted">/ ng∆∞·ªùi</small>
                      <button
                        @click="selectTrip(trip)"
                        class="btn btn-primary w-100 mt-2"
                        :disabled="trip.availableSeats === 0"
                      >
                        {{ trip.availableSeats > 0 ? "Ch·ªçn chuy·∫øn" : "H·∫øt v√©" }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <FeaturesSection />
  </div>
</template>

<script>


import FeaturesSection from "./FeaturesSection.vue";

export default {
  name: "TrangChu",
  components: {
    FeaturesSection,
  },
  data() {
    return {
      cities: [
        "H√† N·ªôi",
        "H·∫£i Ph√≤ng",
        "Qu·∫£ng Ninh",
        "B·∫Øc Ninh",
        "H∆∞ng Y√™n",
        "H√† Nam",
        "Nam ƒê·ªãnh",
        "Ninh B√¨nh",
        "Thanh H√≥a",
        "Ngh·ªá An",
        "H√† Tƒ©nh",
        "Qu·∫£ng B√¨nh",
        "Qu·∫£ng Tr·ªã",
        "Th·ª´a Thi√™n Hu·∫ø",
        "ƒê√† N·∫µng",
        "Qu·∫£ng Nam",
        "Qu·∫£ng Ng√£i",
        "B√¨nh ƒê·ªãnh",
        "Ph√∫ Y√™n",
        "Kh√°nh H√≤a",
        "Ninh Thu·∫≠n",
        "B√¨nh Thu·∫≠n",
        "Kon Tum",
        "Gia Lai",
        "ƒê·∫Øk L·∫Øk",
        "ƒê·∫Øk N√¥ng",
        "L√¢m ƒê·ªìng",
        "B√¨nh Ph∆∞·ªõc",
        "B√¨nh D∆∞∆°ng",
        "ƒê·ªìng Nai",
        "B√† R·ªãa - V≈©ng T√†u",
        "TP. H·ªì Ch√≠ Minh",
        "Long An",
        "C·∫ßn Th∆°",
      ],
      searchForm: {
        vehicleType: "",
        from: "",
        to: "",
        departureDate: "",
        returnDate: "",
        passengers: "1",
        pickupStation: "",
        dropoffStation: "",
        company: "",
      },
      stationsByCity: {
        "H√† N·ªôi": [
          "B·∫øn xe Gi√°p B√°t",
          "B·∫øn xe M·ªπ ƒê√¨nh",
          "B·∫øn xe N∆∞·ªõc Ng·∫ßm",
          "B·∫øn xe Gia L√¢m",
        ],
        "H·∫£i Ph√≤ng": ["B·∫øn xe Ni·ªám Nghƒ©a", "B·∫øn xe C·∫ßu R√†o", "B·∫øn xe Th∆∞·ª£ng L√Ω"],
        "Qu·∫£ng Ninh": ["B·∫øn xe B√£i Ch√°y", "B·∫øn xe C·∫©m Ph·∫£", "B·∫øn xe M√≥ng C√°i"],
        "B·∫Øc Ninh": ["B·∫øn xe B·∫Øc Ninh", "B·∫øn xe Gia B√¨nh"],
        "H∆∞ng Y√™n": ["B·∫øn xe H∆∞ng Y√™n", "B·∫øn xe M·ªπ H√†o"],
        "H√† Nam": ["B·∫øn xe Ph·ªß L√Ω"],
        "Nam ƒê·ªãnh": ["B·∫øn xe Nam ƒê·ªãnh", "B·∫øn xe M·ªπ L·ªôc"],
        "Ninh B√¨nh": ["B·∫øn xe Ninh B√¨nh", "B·∫øn xe Kim S∆°n"],
        "Thanh H√≥a": ["B·∫øn xe Thanh H√≥a", "B·∫øn xe ph√≠a B·∫Øc Thanh H√≥a"],
        "Ngh·ªá An": ["B·∫øn xe Vinh", "B·∫øn xe ph√≠a B·∫Øc Vinh"],
        "H√† Tƒ©nh": ["B·∫øn xe H√† Tƒ©nh", "B·∫øn xe C·∫©m Xuy√™n"],
        "Qu·∫£ng B√¨nh": ["B·∫øn xe ƒê·ªìng H·ªõi", "B·∫øn xe Ba ƒê·ªìn"],
        "Qu·∫£ng Tr·ªã": ["B·∫øn xe ƒê√¥ng H√†", "B·∫øn xe Qu·∫£ng Tr·ªã"],
        "Th·ª´a Thi√™n Hu·∫ø": ["B·∫øn xe Hu·∫ø", "B·∫øn xe ph√≠a Nam Hu·∫ø"],
        "ƒê√† N·∫µng": ["B·∫øn xe Trung t√¢m", "B·∫øn xe ph√≠a B·∫Øc"],
        "Qu·∫£ng Nam": ["B·∫øn xe Tam K·ª≥", "B·∫øn xe H·ªôi An"],
        "Qu·∫£ng Ng√£i": ["B·∫øn xe Qu·∫£ng Ng√£i", "B·∫øn xe ƒê·ª©c Ph·ªï"],
        "B√¨nh ƒê·ªãnh": ["B·∫øn xe Quy Nh∆°n", "B·∫øn xe Ph√π C√°t"],
        "Ph√∫ Y√™n": ["B·∫øn xe Tuy H√≤a", "B·∫øn xe S√¥ng C·∫ßu"],
        "Kh√°nh H√≤a": ["B·∫øn xe Nha Trang", "B·∫øn xe Ninh H√≤a", "B·∫øn xe Cam Ranh"],
        "Ninh Thu·∫≠n": ["B·∫øn xe Phan Rang", "B·∫øn xe Ninh S∆°n"],
        "B√¨nh Thu·∫≠n": ["B·∫øn xe Phan Thi·∫øt", "B·∫øn xe B·∫Øc B√¨nh"],
        "Kon Tum": ["B·∫øn xe Kon Tum", "B·∫øn xe ƒê·∫Øk T√¥"],
        "Gia Lai": ["B·∫øn xe Pleiku", "B·∫øn xe An Kh√™"],
        "ƒê·∫Øk L·∫Øk": ["B·∫øn xe Bu√¥n Ma Thu·ªôt", "B·∫øn xe Ea Kar"],
        "ƒê·∫Øk N√¥ng": ["B·∫øn xe Gia Nghƒ©a", "B·∫øn xe ƒê·∫Øk Mil"],
        "L√¢m ƒê·ªìng": ["B·∫øn xe ƒê√† L·∫°t", "B·∫øn xe B·∫£o L·ªôc"],
        "B√¨nh Ph∆∞·ªõc": ["B·∫øn xe ƒê·ªìng Xo√†i", "B·∫øn xe Ch∆°n Th√†nh"],
        "B√¨nh D∆∞∆°ng": ["B·∫øn xe B√¨nh D∆∞∆°ng", "B·∫øn xe Dƒ© An"],
        "ƒê·ªìng Nai": ["B·∫øn xe Bi√™n H√≤a", "B·∫øn xe Long Kh√°nh"],
        "B√† R·ªãa - V≈©ng T√†u": ["B·∫øn xe V≈©ng T√†u", "B·∫øn xe B√† R·ªãa"],
        "TP. H·ªì Ch√≠ Minh": [
          "B·∫øn xe Mi·ªÅn ƒê√¥ng",
          "B·∫øn xe Mi·ªÅn T√¢y",
          "B·∫øn xe An S∆∞∆°ng",
        ],
        "Long An": ["B·∫øn xe T√¢n An", "B·∫øn xe B·∫øn L·ª©c"],
        "C·∫ßn Th∆°": ["B·∫øn xe C·∫ßn Th∆°", "B·∫øn xe √î M√¥n"],
        __default: ["Trung t√¢m"],
      },
      trainStationsByCity: {
        "H√† N·ªôi": ["Ga H√† N·ªôi", "Ga Long Bi√™n"],
        "H·∫£i Ph√≤ng": ["Ga H·∫£i Ph√≤ng"],
        "Qu·∫£ng Ninh": ["Ga H·∫° Long", "Ga C√°i L√¢n"],
        "B·∫Øc Ninh": ["Ga B·∫Øc Ninh"],
        "H∆∞ng Y√™n": ["Ga Ph·ªë N·ªëi"],
        "H√† Nam": ["Ga Ph·ªß L√Ω"],
        "Nam ƒê·ªãnh": ["Ga Nam ƒê·ªãnh"],
        "Ninh B√¨nh": ["Ga Ninh B√¨nh"],
        "Thanh H√≥a": ["Ga Thanh H√≥a"],
        "Ngh·ªá An": ["Ga Vinh"],
        "H√† Tƒ©nh": ["Ga Y√™n Trung"],
        "Qu·∫£ng B√¨nh": ["Ga ƒê·ªìng H·ªõi"],
        "Qu·∫£ng Tr·ªã": ["Ga ƒê√¥ng H√†"],
        "Th·ª´a Thi√™n Hu·∫ø": ["Ga Hu·∫ø"],
        "ƒê√† N·∫µng": ["Ga ƒê√† N·∫µng"],
        "Qu·∫£ng Nam": ["Ga Tam K·ª≥"],
        "Qu·∫£ng Ng√£i": ["Ga Qu·∫£ng Ng√£i"],
        "B√¨nh ƒê·ªãnh": ["Ga Di√™u Tr√¨", "Ga Quy Nh∆°n"],
        "Ph√∫ Y√™n": ["Ga Tuy H√≤a"],
        "Kh√°nh H√≤a": ["Ga Nha Trang"],
        "Ninh Thu·∫≠n": ["Ga Th√°p Ch√†m"],
        "B√¨nh Thu·∫≠n": ["Ga Phan Thi·∫øt", "Ga M∆∞∆°ng M√°n"],
        "Kon Tum": ["Ga Ng·ªçc H·ªìi"],
        "Gia Lai": ["Ga Mang Yang"],
        "ƒê·∫Øk L·∫Øk": ["Ga Bu√¥n H·ªì"],
        "ƒê·∫Øk N√¥ng": ["Ga ƒê·ª©c L·∫≠p"],
        "L√¢m ƒê·ªìng": ["Ga Tr·∫°i M√°t"],
        "B√¨nh Ph∆∞·ªõc": ["Ga ƒê·ªìng Xo√†i"],
        "B√¨nh D∆∞∆°ng": ["Ga Dƒ© An", "Ga S√≥ng Th·∫ßn"],
        "ƒê·ªìng Nai": ["Ga Bi√™n H√≤a", "Ga Long Kh√°nh"],
        "B√† R·ªãa - V≈©ng T√†u": ["Ga Ph√∫ M·ªπ"],
        "TP. H·ªì Ch√≠ Minh": ["Ga S√†i G√≤n"],
        "Long An": ["Ga T√¢n An"],
        "C·∫ßn Th∆°": ["Ga C√°i RƒÉng"],
        __default: ["Ga trung t√¢m"],
      },
      airportsByCity: {
        "H√† N·ªôi": ["S√¢n bay N·ªôi B√†i (HAN)"],
        "H·∫£i Ph√≤ng": ["S√¢n bay C√°t Bi (HPH)"],
        "Qu·∫£ng Ninh": ["S√¢n bay V√¢n ƒê·ªìn (VDO)"],
        "B·∫Øc Ninh": ["S√¢n bay N·ªôi B√†i (HAN)"],
        "H∆∞ng Y√™n": ["S√¢n bay N·ªôi B√†i (HAN)"],
        "H√† Nam": ["S√¢n bay N·ªôi B√†i (HAN)"],
        "Nam ƒê·ªãnh": ["S√¢n bay N·ªôi B√†i (HAN)"],
        "Ninh B√¨nh": ["S√¢n bay N·ªôi B√†i (HAN)"],
        "Thanh H√≥a": ["S√¢n bay Th·ªç Xu√¢n (THD)"],
        "Ngh·ªá An": ["S√¢n bay Vinh (VII)"],
        "H√† Tƒ©nh": ["S√¢n bay Vinh (VII)"],
        "Qu·∫£ng B√¨nh": ["S√¢n bay ƒê·ªìng H·ªõi (VDH)"],
        "Qu·∫£ng Tr·ªã": ["S√¢n bay Ph√∫ B√†i (HUI)"],
        "Th·ª´a Thi√™n Hu·∫ø": ["S√¢n bay Ph√∫ B√†i (HUI)"],
        "ƒê√† N·∫µng": ["S√¢n bay ƒê√† N·∫µng (DAD)"],
        "Qu·∫£ng Nam": ["S√¢n bay Chu Lai (VCL)"],
        "Qu·∫£ng Ng√£i": ["S√¢n bay Chu Lai (VCL)"],
        "B√¨nh ƒê·ªãnh": ["S√¢n bay Ph√π C√°t (UIH)"],
        "Ph√∫ Y√™n": ["S√¢n bay Tuy H√≤a (TBB)"],
        "Kh√°nh H√≤a": ["S√¢n bay Cam Ranh (CXR)"],
        "Ninh Thu·∫≠n": ["S√¢n bay Cam Ranh (CXR)"],
        "B√¨nh Thu·∫≠n": ["S√¢n bay Long Th√†nh (LTN)", "S√¢n bay Cam Ranh (CXR)"],
        "Kon Tum": ["S√¢n bay Pleiku (PXU)"],
        "Gia Lai": ["S√¢n bay Pleiku (PXU)"],
        "ƒê·∫Øk L·∫Øk": ["S√¢n bay Bu√¥n Ma Thu·ªôt (BMV)"],
        "ƒê·∫Øk N√¥ng": ["S√¢n bay Bu√¥n Ma Thu·ªôt (BMV)"],
        "L√¢m ƒê·ªìng": ["S√¢n bay Li√™n Kh∆∞∆°ng (DLI)"],
        "B√¨nh Ph∆∞·ªõc": ["S√¢n bay T√¢n S∆°n Nh·∫•t (SGN)"],
        "B√¨nh D∆∞∆°ng": ["S√¢n bay T√¢n S∆°n Nh·∫•t (SGN)"],
        "ƒê·ªìng Nai": ["S√¢n bay T√¢n S∆°n Nh·∫•t (SGN)", "S√¢n bay Long Th√†nh (LTN)"],
        "B√† R·ªãa - V≈©ng T√†u": ["S√¢n bay T√¢n S∆°n Nh·∫•t (SGN)"],
        "TP. H·ªì Ch√≠ Minh": ["S√¢n bay T√¢n S∆°n Nh·∫•t (SGN)"],
        "Long An": ["S√¢n bay T√¢n S∆°n Nh·∫•t (SGN)"],
        "C·∫ßn Th∆°": ["S√¢n bay C·∫ßn Th∆° (VCA)"],
        __default: ["S√¢n bay g·∫ßn nh·∫•t"],
      },
      busCompanies: [
        "Xe kh√°ch Ph∆∞∆°ng Trang",
        "Xe kh√°ch Th√†nh B∆∞·ªüi",
        "Xe kh√°ch Kumho",
        "Xe kh√°ch Mai Linh",
      ],
      trainCompanies: [
        "T√†u h·ªèa SE1",
        "T√†u h·ªèa SE2",
        "ƒê∆∞·ªùng s·∫Øt Vi·ªát Nam",
      ],
      airlines: [
        "Vietnam Airlines",
        "Vietjet Air",
        "Bamboo Airways",
        "Vietravel Airlines",
      ],
      customPassengers: null,
      showResults: false,
      sortBy: "default",
      filters: {
        time: {
          morning: false,
          afternoon: false,
          evening: false,
        },
        price: {
          max: 1000000,
        },
        available: false,
        freeCancel: false,
      },
      userInfo: {},
      trips: [
        {
          id: 1,
          company: "Xe kh√°ch Ph∆∞∆°ng Trang",
          vehicleType: "Xe kh√°ch",
          departureTime: "08:00",
          arrivalTime: "12:30",
          fromStation: "B·∫øn xe Mi·ªÅn T√¢y",
          toStation: "B·∫øn xe ƒê√† L·∫°t",
          duration: "4h30",
          price: 250000,
          rating: 4.5,
          availableSeats: 15,
          seatType: "Gh·∫ø ng·ªìi",
          freeCancel: true,
        },
        {
          id: 2,
          company: "Vietnam Airlines",
          vehicleType: "M√°y bay",
          departureTime: "14:20",
          arrivalTime: "15:50",
          fromStation: "S√¢n bay T√¢n S∆°n Nh·∫•t",
          toStation: "S√¢n bay ƒê√† L·∫°t",
          duration: "1h30",
          price: 1200000,
          rating: 4.8,
          availableSeats: 8,
          seatType: "H·∫°ng ph·ªï th√¥ng",
          freeCancel: false,
        },
        {
          id: 3,
          company: "T√†u h·ªèa SE1",
          vehicleType: "T√†u h·ªèa",
          departureTime: "22:00",
          arrivalTime: "06:00+1",
          fromStation: "Ga S√†i G√≤n",
          toStation: "Ga ƒê√† L·∫°t",
          duration: "8h00",
          price: 450000,
          rating: 4.2,
          availableSeats: 0,
          seatType: "Gi∆∞·ªùng n·∫±m",
          freeCancel: true,
        },
      ],
      seatModal: {
        visible: false,
        trip: null,
        seatsSelected: [],
        layout: [],
      },
      activeCar: 0,       // üëâ toa hi·ªán t·∫°i
    totalCars: 8, 
    };
  },
  computed: {
    isLoggedIn() {
      return (
        localStorage.getItem("token") && Object.keys(this.userInfo).length > 0
      );
    },
    passengerCount() {
      if (this.searchForm.passengers === "5+") {
        const count = Number(this.customPassengers || 0);
        return isNaN(count) ? 0 : count;
      }
      return Number(this.searchForm.passengers || 0);
    },
    maxSelectableSeats() {
      const requested = this.passengerCount;
      const available = this.seatModal?.trip?.availableSeats ?? requested;
      return Math.max(0, Math.min(requested, available));
    },
    isSearchValid() {
      const baseValid =
        this.searchForm.vehicleType &&
        this.searchForm.from &&
        this.searchForm.to &&
        this.searchForm.departureDate;
      if (!baseValid) return false;
      if (this.searchForm.passengers === "5+") {
        return this.passengerCount >= 6;
      }
      return this.passengerCount >= 1;
    },
    filteredTrips() {
      let filtered = [...this.trips];

      // Filter by time
      if (
        this.filters.time.morning ||
        this.filters.time.afternoon ||
        this.filters.time.evening
      ) {
        filtered = filtered.filter((trip) => {
          const hour = parseInt(trip.departureTime.split(":")[0]);
          return (
            (this.filters.time.morning && hour >= 6 && hour < 12) ||
            (this.filters.time.afternoon && hour >= 12 && hour < 18) ||
            (this.filters.time.evening && hour >= 18 && hour < 24)
          );
        });
      }

      // Filter by price
      filtered = filtered.filter(
        (trip) => trip.price <= this.filters.price.max
      );

      // Filter by available seats
      if (this.filters.available) {
        filtered = filtered.filter((trip) => trip.availableSeats > 0);
      }

      // Filter by free cancel
      if (this.filters.freeCancel) {
        filtered = filtered.filter((trip) => trip.freeCancel);
      }

      // Filter by selected company/carrier
      if (this.searchForm.company) {
        filtered = filtered.filter((trip) => trip.company === this.searchForm.company);
      }

      return filtered;
    },
    sortedTrips() {
      const trips = [...this.filteredTrips];

      switch (this.sortBy) {
        case "time-early":
          return trips.sort((a, b) =>
            a.departureTime.localeCompare(b.departureTime)
          );
        case "time-late":
          return trips.sort((a, b) =>
            b.departureTime.localeCompare(a.departureTime)
          );
        case "price-low":
          return trips.sort((a, b) => a.price - b.price);
        case "price-high":
          return trips.sort((a, b) => b.price - a.price);
        case "rating":
          return trips.sort((a, b) => b.rating - a.rating);
        default:
          return trips;
      }
    },
    pickupLabel() {
      switch (this.searchForm.vehicleType) {
        case 'train':
          return 'Ga ƒë√≥n';
        case 'plane':
          return 'S√¢n bay ƒëi';
        default:
          return 'B·∫øn xe ƒë√≥n';
      }
    },
    dropoffLabel() {
      switch (this.searchForm.vehicleType) {
        case 'train':
          return 'Ga tr·∫£';
        case 'plane':
          return 'S√¢n bay ƒë·∫øn';
        default:
          return 'B·∫øn xe tr·∫£';
      }
    },
    availablePickupStations() {
      const city = this.searchForm.from;
      if (this.searchForm.vehicleType === 'train') {
        return this.trainStationsByCity[city] || this.trainStationsByCity.__default;
      }
      if (this.searchForm.vehicleType === 'plane') {
        return this.airportsByCity[city] || this.airportsByCity.__default;
      }
      return this.stationsByCity[city] || this.stationsByCity.__default;
    },
    availableDropoffStations() {
      const city = this.searchForm.to;
      if (this.searchForm.vehicleType === 'train') {
        return this.trainStationsByCity[city] || this.trainStationsByCity.__default;
      }
      if (this.searchForm.vehicleType === 'plane') {
        return this.airportsByCity[city] || this.airportsByCity.__default;
      }
      return this.stationsByCity[city] || this.stationsByCity.__default;
    },
    companyLabel() {
      switch (this.searchForm.vehicleType) {
        case 'train':
          return 'Ch·ªçn t√†u/nh√† t√†u';
        case 'plane':
          return 'Ch·ªçn h√£ng bay';
        default:
          return 'Ch·ªçn nh√† xe';
      }
    },
    availableCompanies() {
      const type = this.searchForm.vehicleType;
      if (type === 'train') return this.trainCompanies;
      if (type === 'plane') return this.airlines;
      return this.busCompanies;
    },
  },
  methods: {
   
    searchTrips() {
      if (!this.isSearchValid) return;
      this.trips = this.generateMockTrips();
      this.showResults = true;
      this.$nextTick(() => {
        const el = document.querySelector('.results-section');
        if (el) el.scrollIntoView({ behavior: 'smooth' });
      });
    },
    selectTrip(trip) {
      // Open seat selection modal for this trip
      this.openSeatModal(trip);
    },
    formatPrice(price) {
      return new Intl.NumberFormat("vi-VN", {
        style: "currency",
        currency: "VND",
      }).format(price);
    },
    vehicleTypeLabel(typeKey) {
      switch (typeKey) {
        case 'bus':
          return 'Xe kh√°ch';
        case 'train':
          return 'T√†u h·ªèa';
        case 'plane':
          return 'M√°y bay';
        default:
          return typeKey;
      }
    },
    getStationsForCity(city, typeKey) {
      if (typeKey === 'train') {
        return this.trainStationsByCity[city] || this.trainStationsByCity.__default;
      }
      if (typeKey === 'plane') {
        return this.airportsByCity[city] || this.airportsByCity.__default;
      }
      return this.stationsByCity[city] || this.stationsByCity.__default;
    },
    getCompaniesByType(typeKey) {
      if (typeKey === 'train') return this.trainCompanies;
      if (typeKey === 'plane') return this.airlines;
      return this.busCompanies;
    },
    randomBetween(min, max) {
      return Math.random() * (max - min) + min;
    },
    randomInt(min, max) {
      return Math.floor(this.randomBetween(min, max + 1));
    },
    addMinutesToTime(time, minutes) {
      const [h, m] = time.split(':').map((n) => parseInt(n, 10));
      const date = new Date(2000, 0, 1, h, m, 0, 0);
      date.setMinutes(date.getMinutes() + minutes);
      const hh = String(date.getHours()).padStart(2, '0');
      const mm = String(date.getMinutes()).padStart(2, '0');
      return `${hh}:${mm}`;
    },
    generateDepartureTime(typeKey) {
      // Bias time ranges a bit differently per type
      let startHour = 6;
      let endHour = 22;
      if (typeKey === 'plane') {
        startHour = 5; endHour = 21;
      } else if (typeKey === 'train') {
        startHour = 4; endHour = 23;
      }
      const hour = this.randomInt(startHour, endHour);
      const minute = this.randomInt(0, 1) ? 0 : 30;
      return `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
    },
    generateDurationMinutes(typeKey) {
      if (typeKey === 'plane') return this.randomInt(60, 180);
      if (typeKey === 'train') return this.randomInt(240, 720);
      return this.randomInt(120, 480); // bus
    },
    formatDuration(minutes) {
      const h = Math.floor(minutes / 60);
      const m = minutes % 60;
      return `${h}h${String(m).padStart(2, '0')}`;
    },
    generatePrice(typeKey, durationMinutes) {
      if (typeKey === 'plane') return this.randomInt(800000, 3000000);
      if (typeKey === 'train') return this.randomInt(250000, 1200000);
      // bus: scale a little by duration
      const base = 150000 + Math.floor((durationMinutes / 60) * 40000);
      return Math.min(1000000, Math.max(80000, base + this.randomInt(-20000, 100000)));
    },
    generateSeatType(typeKey) {
      if (typeKey === 'plane') return this.randomInt(0, 3) ? 'H·∫°ng ph·ªï th√¥ng' : 'H·∫°ng th∆∞∆°ng gia';
      if (typeKey === 'train') return this.randomInt(0, 1) ? 'Gh·∫ø m·ªÅm' : 'Gi∆∞·ªùng n·∫±m';
      return this.randomInt(0, 1) ? 'Gh·∫ø ng·ªìi' : 'Gi∆∞·ªùng n·∫±m';
    },
    generateMockTrips() {
      const typeKey = this.searchForm.vehicleType;
      const typeLabel = this.vehicleTypeLabel(typeKey);
      const fromCity = this.searchForm.from;
      const toCity = this.searchForm.to;
      const fromStations = this.getStationsForCity(fromCity, typeKey);
      const toStations = this.getStationsForCity(toCity, typeKey);
      const fromStation = this.searchForm.pickupStation || fromStations[0];
      const toStation = this.searchForm.dropoffStation || toStations[0];
      const companies = this.getCompaniesByType(typeKey);

      const desiredCompany = this.searchForm.company || null;
      const listSize = this.randomInt(4, 8);
      const results = [];
      for (let i = 0; i < listSize; i++) {
        const company = desiredCompany || companies[this.randomInt(0, companies.length - 1)];
        const departureTime = this.generateDepartureTime(typeKey);
        const durationMin = this.generateDurationMinutes(typeKey);
        const arrivalTime = this.addMinutesToTime(departureTime, durationMin);
        const price = this.generatePrice(typeKey, durationMin);
        const availableSeats = this.randomInt(0, 30);
        const rating = Math.round(this.randomBetween(3.5, 5) * 10) / 10;
        const freeCancel = this.randomInt(0, 1) === 1;
        const seatType = this.generateSeatType(typeKey);

        results.push({
          id: Date.now() + i,
          company,
          vehicleType: typeLabel,
          departureTime,
          arrivalTime,
          fromStation,
          toStation,
          duration: this.formatDuration(durationMin),
          price,
          rating,
          availableSeats,
          seatType,
          freeCancel,
        });
      }

      // Stable ordering before user sort: by departure time ascending
      results.sort((a, b) => a.departureTime.localeCompare(b.departureTime));
      return results;
    },
    openSeatModal(trip) {
      const maxRows = 8;
      const maxCols = 4;
      const totalSeats = maxRows * maxCols;
      const layout = [];
      let seatNumber = 1;
      
      for (let r = 0; r < maxRows; r++) {
        const row = [];
        for (let c = 0; c < maxCols; c++) {
          const id = seatNumber;
          const available = id <= trip.availableSeats;
          // Randomly assign some seats as booked or unavailable
          const randomStatus = Math.random();
          let booked = false;
          let unavailable = false;
          
          if (randomStatus < 0.1) {
            booked = true; // 10% chance of being booked
          } else if (randomStatus < 0.2) {
            unavailable = true; // 10% chance of being unavailable
          }
          
          row.push({ 
            id, 
            label: "S" + id, 
            available: available && !booked && !unavailable,
            booked,
            unavailable
          });
          seatNumber++;
        }
        layout.push(row);
      }
      
      this.seatModal = {
        visible: true,
        trip,
        seatsSelected: [],
        layout,
      };
    },
    toggleSeat(seat) {
      // Don't allow selection of booked or unavailable seats
      if (seat.booked || seat.unavailable) {
        return;
      }
      
      const maxSelect = this.maxSelectableSeats || 1;
      const idx = this.seatModal.seatsSelected.indexOf(seat.id);
      if (idx >= 0) {
        this.seatModal.seatsSelected.splice(idx, 1);
      } else {
        if (this.seatModal.seatsSelected.length >= maxSelect) return;
        this.seatModal.seatsSelected.push(seat.id);
      }
    },

    toggleTrainSeat(seatId) {
  const idx = this.seatModal.seatsSelected.indexOf(seatId);
  if (idx >= 0) {
    this.seatModal.seatsSelected.splice(idx, 1);
  } else {
    if (this.seatModal.seatsSelected.length >= this.maxSelectableSeats) return;
    this.seatModal.seatsSelected.push(seatId);
  }
},

togglePlaneSeat(seatCode) {
  const idx = this.seatModal.seatsSelected.indexOf(seatCode);
  if (idx >= 0) {
    this.seatModal.seatsSelected.splice(idx, 1);
  } else {
    if (this.seatModal.seatsSelected.length >= this.maxSelectableSeats) return;
    this.seatModal.seatsSelected.push(seatCode);
  }
},

    cancelSeatSelection() {
      this.seatModal.visible = false;
      this.seatModal.trip = null;
      this.seatModal.seatsSelected = [];
    },
  confirmSeats() {
  const selectedCount = (this.seatModal?.seatsSelected || []).length;
  if (selectedCount === 0) {
    alert("Vui l√≤ng ch·ªçn gh·∫ø tr∆∞·ªõc khi ti·∫øp t·ª•c thanh to√°n.");
    return;
  }

  const trip = this.seatModal.trip || {};
  const price = Number(trip.price || 0);
  const total = price * selectedCount;
 const formattedSeats = (this.seatModal.seatsSelected || []).map(code => {
  if (this.seatModal.trip?.vehicleType === 'T√†u h·ªèa' && typeof code === 'string' && code.includes('-')) {
    // X√≥a k√Ω t·ª± ch·ªØ c√°i (T ho·∫∑c B) ·ªü ƒë·∫ßu, v√≠ d·ª•: T0-1-3 ‚Üí 0-1-3
    const cleanCode = code.replace(/^[A-Za-z]/, '');
    const [car, row, seat] = cleanCode.split('-').map(Number);
    const seatNumber = (row - 1) * 8 + seat;
    return `Toa ${car + 1} - Gh·∫ø ${seatNumber}`;
  }
  return code;
});
const seatsParam = formattedSeats.join(",");


  // ƒê√≥ng modal ch·ªçn gh·∫ø
  this.cancelSeatSelection();

  // Chuy·ªÉn h∆∞·ªõng sang trang thanh to√°n v·ªõi ƒë·∫ßy ƒë·ªß th√¥ng tin
  this.$router
    .push({
      path: "/client-thanh-toan",
      query: {
        total: String(total),
        tripId: String(trip.id || ""),
        seats: seatsParam,
        passengers: String(this.passengerCount || selectedCount),
        from: this.searchForm?.from || "",
        to: this.searchForm?.to || "",
        date: this.searchForm?.departureDate || "",
        pickupStation: this.searchForm?.pickupStation || "",
        dropoffStation: this.searchForm?.dropoffStation || "",
        company: trip.company || "",
        vehicleType: trip.vehicleType || "",
        departureTime: trip.departureTime || "",
        arrivalTime: trip.arrivalTime || "",
        seatType: trip.seatType || ""
      }
    })
    .catch(() => {
      /* ignore navigation duplicate errors */
    });
},
    checkAuthStatus() {
      // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p t·ª´ localStorage
      const token = localStorage.getItem("token");
      const userInfo = localStorage.getItem("userInfo");

      if (token && userInfo) {
        try {
          this.userInfo = JSON.parse(userInfo);
        } catch (error) {
          console.error("Error parsing user info:", error);
          this.logout();
        }
      }
    },
    logout() {
      // X√≥a th√¥ng tin ƒëƒÉng nh·∫≠p
      localStorage.removeItem("token");
      localStorage.removeItem("userInfo");
      this.userInfo = {};

      // Th√¥ng b√°o ƒëƒÉng xu·∫•t th√†nh c√¥ng
      alert("ƒêƒÉng xu·∫•t th√†nh c√¥ng!");

      // Reload trang ƒë·ªÉ c·∫≠p nh·∫≠t UI
      this.$router.go(0);
    },
  },
  mounted() {
    // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p khi component ƒë∆∞·ª£c mount
    this.checkAuthStatus();
  },
};
</script>

<style>




</style>
